@import "mixins.less";

@grid: 100px;

* {
	.no-smoothing;
}

html, body {
	height: 100%;
	margin: 0; padding: 0;
	overflow: hidden;
}

body {
	.perspective-origin(50%, 0%);
	background: #000;
}

#HUD{
	position: absolute;
	left: 0;
	right: 0;
	height: 50px;
	line-height: 10px;
	padding: 20px;
	background: rgba(0,0,0,.4);
	color: #fff;
	font-family: 'Helvetica Neue';
	font-weight: 300;
	
	.just();
}

#World{
	position: absolute;
	left: 50%;
	top: 50%;
	
	.transform-style(preserve-3d);
}

.x-plane{
	-webkit-filter: brightness(80%);
}

.y-plane{
	-webkit-filter: brightness(90%);
	
	&.negative{
		-webkit-filter: brightness(60%);
	}
}

.room{
	position: absolute;
	left: 0;
	bottom: 0;
	
	.transform-style(preserve-3d);
}

.wall{
	.box-sizing(border-box);
	position: absolute;
	left: 0;
	bottom: 0;

	.transform-origin(0%, 0%);
	&:not(.backface){
		.wf();
	}
	
	&.portal{
		.transition(all 500ms cubic-bezier(0.165, 0.84, 0.44, 1));
	}

	.object {
		position: absolute;

		img {
			width: 100%;
		}
	}
}

.floortile{
	position: absolute;
	padding-top: 1px;
	left: 0;
	bottom: 0;
	border-top: 1px solid transparent;
}

@playerRotateX: 90deg;

.char{
	position: absolute;
	left: 0;
	bottom: 0;
	background: blue;
	
	.transform-style(preserve-3d);

	.avatar{
		position: absolute;
		left: 50%;
		bottom: 50%;
		margin-left: -@grid/2;
		width: @grid;
		height: 2*@grid;
		
		.transition(all 200ms);
		.transform-origin(50%, 100%);
		.transform-style(preserve-3d);
		
		.transform(rotateX((@playerRotateX * -1)));
		
		.feet {
			.transform(translateZ(1px));
		}
	
		.down&{
			.transform(rotateX((@playerRotateX * -1)) rotateY(180deg));

			.feet {
				.transform(translateZ(-1px));
			}
		}
	
		.right&{
			//.transform(rotateX(@playerRotateX) rotateY(90deg));
		}
	
		.left&{
			//.transform(rotateX(@playerRotateX) rotateY(270deg));
		}
	
		.player[data-room='garage']&{
			background: #fff;
		}
	
		&:after{
			content: '';
			display: block;
			position: absolute;
			left: 50%;
			bottom: 0;
			width: (@grid / 2);
			height: 0px;
			margin-left: (@grid / -4);
			border-radius: 100%;
			background: rgba(0,0,0,.15);
		
			box-shadow: 0 0 25px 5px rgba(0,0,0,.5);
		
			.transform(rotateX(@playerRotateX) translate3d(0,0,1px));
		}

		img {
			width: 100%;
		}

		.body {
			position: absolute;
			bottom: 8px;
		}

		.feet {
			position: absolute;
			bottom: 0; height: 20px;
			left: 14px; right: 14px;

			img {
				position: absolute;
				width: 55%;
				right: 0; bottom: 0;
				&:first-child {
					right: auto;
					left: 0;
				}
			}
		}
	}

	&.walking {
		.avatar {
			.feet {
				.animation(walking 250ms steps(1) infinite);
				img {
					&:first-child {
						bottom: 5px;
					}
				}
			}
		}
	}
}

@-webkit-keyframes walking { .walking-frames; }
@-moz-keyframes walking { .walking-frames; }
@-ms-keyframes walking { .walking-frames; }
@-o-keyframes walking { .walking-frames; }
@keyframes walking { .walking-frames; }
.walking-frames() {
	0% {
		.transform(none);
	}
	50% {
		.transform(scaleX(-1));
	}
	100% {
		.transform(none);
	}
}

.coworker{
	.avatar{
		background: blue;
	}
}

.furniture,
.furniture .face{
	position: absolute;
	left: 0;
	bottom: 0;
	background: gold;
	
	.transform-style(preserve-3d);
}

.furniture .face{
	background: blue;
	
	.transform-origin(0%, 0%);	
	.wf();
}

.furniture {
	.object {
		position: absolute;
		.transform-origin(50%, 100%);
		.transform(rotateX(-90deg));

		img {
			max-width: 100%;
		}
	}
}

.desk {

	.x-plane {
		background-size: 50% auto !important;
	}

	.x-plane:not(.negative) {
		.backface-visibility(visible);
	}

	.x-plane, .y-plane {
		&:before {
			content: "";
			.box-sizing(border-box);
			.fill-container;
			border-bottom: 10px solid white;
		}
	}
}

.table {
	.box-sizing(border-box);
	background-size: 40px !important;
	&:after {
		content: "";
		.fill-container;
		border: 1px solid fadeOut(black, 75%);
	}

	.x-plane.negative {
		&:after {
			content: "";
			.fill-container;
			left: 8px; right: 8px;
			bottom: 8px;
			background: white;
		}
	}
}